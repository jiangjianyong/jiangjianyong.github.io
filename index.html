<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="行易难">
<meta property="og:url" content="https://jianyong.github.io/index.html">
<meta property="og:site_name" content="行易难">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="行易难">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://jianyong.github.io/"/>





  <title>行易难</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">行易难</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jianyong.github.io/2018/07/24/字符串查找/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jianyong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="行易难">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/24/字符串查找/" itemprop="url">字符串查找</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-24T18:49:12+08:00">
                2018-07-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>面试题: 判断字符串是否在另一个字符串中存在？</p>
</blockquote>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="方法一-语言特性-内置函数"><a href="#方法一-语言特性-内置函数" class="headerlink" title="方法一: 语言特性-内置函数"></a>方法一: 语言特性-内置函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/* strpos示例 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, strpos(<span class="string">'xasfsdfbk'</span>, <span class="string">'xasfsdfbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, strpos(<span class="string">'xasfsdfbk'</span>, <span class="string">'fbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, strpos(<span class="string">'xasfsdfbk'</span>, <span class="string">'xs'</span>) != <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, strpos(<span class="string">'xasfsdfbk'</span>, <span class="string">'sfs'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code</span></span><br><span class="line">strpos(<span class="string">'xasfsdfbk'</span>, <span class="string">'sfs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// mb* 相关的函数也可, 比如说mb_strpos是基于字符数执行一个多字节安全的 strpos() 操作。</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://php.net/manual/zh/function.strpos.php" target="_blank" rel="noopener">strpos</a></td>
<td>查找字符串首次出现的位置</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.stripos.php" target="_blank" rel="noopener">stripos</a></td>
<td>查找字符串首次出现的位置（不区分大小写）</td>
<td>PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.strrpos.php" target="_blank" rel="noopener">strrpos</a></td>
<td>计算指定字符串在目标字符串中最后一次出现的位置</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.strripos.php" target="_blank" rel="noopener">strripos</a></td>
<td>计算指定字符串在目标字符串中最后一次出现的位置（不区分大小写）</td>
<td>PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.mb-strpos.php" target="_blank" rel="noopener">mb_strpos</a></td>
<td>查找字符串在另一个字符串中首次出现的位置</td>
<td>PHP 4 &gt;= 4.0.6, PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.strstr.php" target="_blank" rel="noopener">strstr</a></td>
<td>查找字符串的首次出现</td>
<td>PHP 4, PHP 5, PHP 7 </td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.stristr.php" target="_blank" rel="noopener">stristr</a></td>
<td>strstr() 函数的忽略大小写版本</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.substr-count.php" target="_blank" rel="noopener">substr_count</a></td>
<td>计算字串出现的次数</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
</tbody>
</table>
<h3 id="方法二-语言特性-正则匹配"><a href="#方法二-语言特性-正则匹配" class="headerlink" title="方法二: 语言特性-正则匹配"></a>方法二: 语言特性-正则匹配</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xasfsdfbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'fbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xs'</span>) != <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'sfs'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_match</span><span class="params">($a, $b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_match(<span class="string">'/'</span> . $b . <span class="string">'/i'</span>, $a, $matchs) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://php.net/manual/zh/function.preg-match.php" target="_blank" rel="noopener">preg_match</a></td>
<td>执行匹配正则表达式</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.preg-match-all.php" target="_blank" rel="noopener">preg_match_all</a></td>
<td>执行一个全局正则表达式匹配</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
</tbody>
</table>
<h3 id="方法三-语言特性-字符串分割"><a href="#方法三-语言特性-字符串分割" class="headerlink" title="方法三: 语言特性-字符串分割"></a>方法三: 语言特性-字符串分割</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xasfsdfbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'fbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xs'</span>) != <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'sfs'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_match</span><span class="params">($a, $b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count(explode($b, $a)) &gt;= <span class="number">2</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// strtok 可以么?</span></span><br><span class="line"><span class="comment">// 在分割字符串时，split()与explode()谁快?</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://php.net/manual/zh/function.strtok.php" target="_blank" rel="noopener">strtok</a></td>
<td>标记分割字符串</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.explode.php" target="_blank" rel="noopener">explode</a></td>
<td>使用一个字符串分割另一个字符串</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.split.php" target="_blank" rel="noopener">split</a></td>
<td>用正则表达式将字符串分割到数组中</td>
<td>PHP 4, PHP 5</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.mb-split.php" target="_blank" rel="noopener">mb_split</a></td>
<td>使用正则表达式分割多字节字符串</td>
<td>PHP 4 &gt;= 4.2.0, PHP 5, PHP 7</td>
</tr>
<tr>
<td><a href="http://php.net/manual/zh/function.preg-split.php" target="_blank" rel="noopener">preg_split</a></td>
<td>通过一个正则表达式分隔字符串</td>
<td>PHP 4, PHP 5, PHP 7</td>
</tr>
</tbody>
</table>
<h3 id="方法四-很暴力的查找"><a href="#方法四-很暴力的查找" class="headerlink" title="方法四: 很暴力的查找"></a>方法四: 很暴力的查找</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xasfsdfbk'</span>) !== <span class="number">-1</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'fbk'</span>) !== <span class="number">-1</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xs'</span>) !== <span class="number">-1</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'sfs'</span>) !== <span class="number">-1</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_match</span><span class="params">($a, $b)</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span>($a == $b) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $aArr = str_split($a);</span><br><span class="line">    $bArr = str_split($b);</span><br><span class="line">    </span><br><span class="line">    $aLen = count($aArr);</span><br><span class="line">    $bLen = count($bArr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($bLen &gt; $aLen) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $data = [];</span><br><span class="line">    </span><br><span class="line">    $aLastIndex = <span class="number">-1</span>;</span><br><span class="line">    $bStartIndex = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>($ai = <span class="number">0</span>; $ai &lt; $aLen; $ai++) &#123;</span><br><span class="line">        $av = $aArr[$ai];</span><br><span class="line">        </span><br><span class="line">        $exists = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span>($bi = $bStartIndex; $bi &lt; $bLen; $bi++) &#123;</span><br><span class="line">            $bv = $bArr[$bi];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(($aLastIndex == <span class="number">-1</span> || $ai == ($aLastIndex + <span class="number">1</span>)) &amp;&amp; $av == $bv) &#123;</span><br><span class="line">                $exists = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ($aLastIndex != <span class="number">-1</span> &amp;&amp; $ai == ($aLastIndex + <span class="number">1</span>) &amp;&amp; $av != $bv) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ($exists) &#123;</span><br><span class="line">            $aLastIndex = $ai;</span><br><span class="line">            $bStartIndex = $bi + <span class="number">1</span>;</span><br><span class="line">            array_push($data, [</span><br><span class="line">                <span class="string">'value'</span> =&gt; $av,</span><br><span class="line">                <span class="string">'index'</span> =&gt; $ai</span><br><span class="line">            ]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $aLastIndex = <span class="number">-1</span>;</span><br><span class="line">            $bStartIndex = <span class="number">0</span>;</span><br><span class="line">            $data = [];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ($exists &amp;&amp; $bLen == $bStartIndex) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($data) &amp;&amp; count($data) == $bLen) &#123;</span><br><span class="line">        $begin = array_shift($data);</span><br><span class="line">        <span class="keyword">return</span> $begin[<span class="string">'index'</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法五-朴素算法-暴力查找"><a href="#方法五-朴素算法-暴力查找" class="headerlink" title="方法五: 朴素算法(暴力查找)"></a>方法五: 朴素算法(暴力查找)</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// demo</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xasfsdfbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'fbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xs'</span>) != <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'sfs'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_match</span><span class="params">($a, $b)</span> </span>&#123;</span><br><span class="line">    $aArr = str_split($a);</span><br><span class="line">    $bArr = str_split($b);</span><br><span class="line">    </span><br><span class="line">    $aLen = count($aArr);</span><br><span class="line">    $bLen = count($bArr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> ($ai = <span class="number">0</span>; $ai &lt;= $aLen - $bLen; $ai++) &#123;</span><br><span class="line">        <span class="keyword">for</span> ($bi = <span class="number">0</span>; $bi &lt; $bLen; $bi++) &#123;</span><br><span class="line">            <span class="keyword">if</span>($aArr[$ai + $bi] != $bArr[$bi]) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>($bLen == $bi) &#123;</span><br><span class="line">            <span class="keyword">return</span> $ai;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法六-字符串查找算法-Rabin-Karp算法"><a href="#方法六-字符串查找算法-Rabin-Karp算法" class="headerlink" title="方法六: 字符串查找算法-Rabin-Karp算法"></a>方法六: 字符串查找算法-Rabin-Karp算法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BASE 256</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MODULUS 101</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RabinKarp</span><span class="params">(<span class="keyword">char</span> t[], <span class="keyword">char</span> p[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t_len = <span class="built_in">strlen</span>(t);</span><br><span class="line">    <span class="keyword">int</span> p_len = <span class="built_in">strlen</span>(p);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 哈希滚动之用</span></span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p_len - <span class="number">1</span>; i++)</span><br><span class="line">        h = (h * BASE) % MODULUS;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> t_hash = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> p_hash = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; p_len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        t_hash = (BASE * t_hash + t[i]) % MODULUS;</span><br><span class="line">        p_hash = (BASE * p_hash + p[i]) % MODULUS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= t_len - p_len)</span><br><span class="line">    &#123;</span><br><span class="line">         <span class="comment">// 考虑到哈希碰撞的可能性，还需要用 memcmp 再比对一下</span></span><br><span class="line">        <span class="keyword">if</span> (t_hash == p_hash &amp;&amp; <span class="built_in">memcmp</span>(p, t + i, p_len) == <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; p &lt;&lt; <span class="string">" is found at index "</span> &lt;&lt; i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 哈希滚动</span></span><br><span class="line">        t_hash = (BASE * (t_hash - t[i] * h) + t[i + p_len]) % MODULUS;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 防止出现负数</span></span><br><span class="line">        <span class="keyword">if</span> (t_hash &lt; <span class="number">0</span>)</span><br><span class="line">            t_hash = t_hash + MODULUS;</span><br><span class="line"></span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> t[<span class="number">100</span>] = <span class="string">"It is a test, but not just a test"</span>;</span><br><span class="line">    <span class="keyword">char</span> p[<span class="number">10</span>] = <span class="string">"test"</span>;</span><br><span class="line">    </span><br><span class="line">    RabinKarp(t, p);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// php 实现</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hash_string</span><span class="params">($str, $len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $hash = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    $hash_table = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'h'</span> =&gt; <span class="number">1</span>,</span><br><span class="line">        <span class="string">'e'</span> =&gt; <span class="number">2</span>,</span><br><span class="line">        <span class="string">'l'</span> =&gt; <span class="number">3</span>,</span><br><span class="line">        <span class="string">'o'</span> =&gt; <span class="number">4</span>,</span><br><span class="line">        <span class="string">'w'</span> =&gt; <span class="number">5</span>,</span><br><span class="line">        <span class="string">'r'</span> =&gt; <span class="number">6</span>,</span><br><span class="line">        <span class="string">'d'</span> =&gt; <span class="number">7</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">        $hash .= $hash_table[$str&#123;$i&#125;];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (int)$hash;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rabin_karp</span><span class="params">($text, $pattern)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $n = strlen($text);</span><br><span class="line">    $m = strlen($pattern);</span><br><span class="line"></span><br><span class="line">    $text_hash = hash_string(substr($text, <span class="number">0</span>, $m), $m);</span><br><span class="line">    $pattern_hash = hash_string($pattern, $m);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $n-$m+<span class="number">1</span>; $i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($text_hash == $pattern_hash) &#123;</span><br><span class="line">            <span class="keyword">return</span> $i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $text_hash = hash_string(substr($text, $i, $m), $m);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="keyword">echo</span> rabin_karp(<span class="string">'hello world'</span>, <span class="string">'ello'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="方法七-字符串查找算法-KMP"><a href="#方法七-字符串查找算法-KMP" class="headerlink" title="方法七: 字符串查找算法-KMP"></a>方法七: 字符串查找算法-KMP</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KMP</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">KMPSearch</span><span class="params">(String txt, String pat, <span class="keyword">int</span>[] next)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> M = txt.length();</span><br><span class="line">        <span class="keyword">int</span> N = pat.length();</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; M &amp;&amp; j &lt; N) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j == -<span class="number">1</span> || txt.charAt(i) == pat.charAt(j)) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                j = next[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j == N)</span><br><span class="line">            <span class="keyword">return</span> i - j;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getNext</span><span class="params">(String pat, <span class="keyword">int</span>[] next)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> N = pat.length();</span><br><span class="line">        next[<span class="number">0</span>] = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> k = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (j &lt; N - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k == -<span class="number">1</span> || pat.charAt(j) == pat.charAt(k)) &#123;</span><br><span class="line">                ++k;</span><br><span class="line">                ++j;</span><br><span class="line">                next[j] = k;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">                k = next[k];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String txt = <span class="string">"BBC ABCDAB CDABABCDABCDABDE"</span>;</span><br><span class="line">        String pat = <span class="string">"ABCDABD"</span>;</span><br><span class="line">        <span class="keyword">int</span>[] next = <span class="keyword">new</span> <span class="keyword">int</span>[pat.length()];</span><br><span class="line">        getNext(pat, next);</span><br><span class="line">        System.out.println(KMPSearch(txt, pat, next));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法八-字符串查找算法-Boyer-Moore"><a href="#方法八-字符串查找算法-Boyer-Moore" class="headerlink" title="方法八: 字符串查找算法-Boyer-Moore"></a>方法八: 字符串查找算法-Boyer-Moore</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BoyerMoore</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getRight</span><span class="params">(String pat, <span class="keyword">int</span>[] right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)&#123;</span><br><span class="line">            right[i] = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pat.length(); i++) &#123;</span><br><span class="line">            right[pat.charAt(i)] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">BoyerMooreSearch</span><span class="params">(String txt, String pat, <span class="keyword">int</span>[] right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> M = txt.length();</span><br><span class="line">        <span class="keyword">int</span> N = pat.length();</span><br><span class="line">        <span class="keyword">int</span> skip;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= M - N; i += skip) &#123;</span><br><span class="line">            skip = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = N - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">                <span class="keyword">if</span> (pat.charAt(j) != txt.charAt(i + j)) &#123;</span><br><span class="line">                    skip = j - right[txt.charAt(i + j)];</span><br><span class="line">                    <span class="keyword">if</span> (skip &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                        skip = <span class="number">1</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (skip == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String txt = <span class="string">"BBC ABCDAB AACDABABCDABCDABDE"</span>;</span><br><span class="line">        String pat = <span class="string">"ABCDABD"</span>;</span><br><span class="line">        <span class="keyword">int</span>[] right = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</span><br><span class="line">        getRight(pat,right);</span><br><span class="line">        System.out.println(BoyerMooreSearch(txt, pat, right));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法九-字符串查找算法-Sunday"><a href="#方法九-字符串查找算法-Sunday" class="headerlink" title="方法九: 字符串查找算法-Sunday"></a>方法九: 字符串查找算法-Sunday</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sunday</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">(String pat, Character c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = pat.length() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pat.charAt(i) == c)</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">SundaySearch</span><span class="params">(String txt, String pat)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> M = txt.length();</span><br><span class="line">        <span class="keyword">int</span> N = pat.length();</span><br><span class="line">        <span class="keyword">int</span> i, j;</span><br><span class="line">        <span class="keyword">int</span> skip = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= M - N; i += skip) &#123;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; N; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (txt.charAt(i + j) != pat.charAt(j))&#123;</span><br><span class="line">                    <span class="keyword">if</span> (i == M - N)</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    skip = N - getIndex(pat, txt.charAt(i + N));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (j == N)</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String txt = <span class="string">"BBC ABCDAB AACDABABCDABCDABD"</span>;</span><br><span class="line">        String pat = <span class="string">"ABCDABD"</span>;</span><br><span class="line">        System.out.println(SundaySearch(txt, pat));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法十-字符串查找算法-BF算法-Brute-Force"><a href="#方法十-字符串查找算法-BF算法-Brute-Force" class="headerlink" title="方法十: 字符串查找算法-BF算法(Brute Force)"></a>方法十: 字符串查找算法-BF算法(Brute Force)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;  </span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">index_bf</span><span class="params">(<span class="keyword">char</span> *s,<span class="keyword">char</span> *t,<span class="keyword">int</span> pos)</span></span>;  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">index_bf_self</span><span class="params">(<span class="keyword">char</span> *s,<span class="keyword">char</span> *t,<span class="keyword">int</span> index)</span></span>;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">char</span> s[]=<span class="string">"6he3wor"</span>; <span class="comment">//标准BF算法中，s[0]和t[0]存放的为字符串长度。  </span></span><br><span class="line">    <span class="keyword">char</span> t[]=<span class="string">"3wor"</span>;  </span><br><span class="line">    <span class="keyword">int</span> m=index_bf(s,t,<span class="number">2</span>); <span class="comment">//标准BF算法  </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"index_bf:%d\n"</span>,m);  </span><br><span class="line">    m=index_bf_self(s,t,<span class="number">2</span>); <span class="comment">//修改版BF算法，s和t中，不必再存放字符串长度。  </span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"index_bf_self:%d\n"</span>,m);  </span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">字符串S和T中，s[0],t[0]存放必须为字符串长度 </span></span><br><span class="line"><span class="comment">例：s[]="7hi baby!"  T[]="4baby"  index_bf(s,t,1); </span></span><br><span class="line"><span class="comment">pos：在S中要从下标pos处开始查找T </span></span><br><span class="line"><span class="comment">(说明：标准BF算法中，为研究方便，s[0],t[0]中存放的为各自字符串长度。) </span></span><br><span class="line"><span class="comment">*/</span>  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">index_bf</span><span class="params">(<span class="keyword">char</span> *s,<span class="keyword">char</span> *t,<span class="keyword">int</span> pos)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> i,j;  </span><br><span class="line">    <span class="keyword">if</span>(pos&gt;=<span class="number">1</span> &amp;&amp; pos &lt;=s[<span class="number">0</span>]-<span class="string">'0'</span>)  </span><br><span class="line">    &#123;  </span><br><span class="line">        i=pos;  </span><br><span class="line">        j=<span class="number">1</span>;  </span><br><span class="line">        <span class="keyword">while</span>(i&lt;=s[<span class="number">0</span>]-<span class="string">'0'</span>&amp;&amp;j&lt;=t[<span class="number">0</span>]-<span class="string">'0'</span>)  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">if</span>(s[i]==t[j])  </span><br><span class="line">            &#123;  </span><br><span class="line">                i++;  </span><br><span class="line">                j++;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">else</span>   </span><br><span class="line">            &#123;  </span><br><span class="line">                j=<span class="number">1</span>;  </span><br><span class="line">                i=i-j+<span class="number">2</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">if</span>(j&gt;t[<span class="number">0</span>]-<span class="string">'0'</span>)  </span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">return</span> i-t[<span class="number">0</span>]+<span class="string">'0'</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">else</span>   </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">修改版，字符串s和t中，不必再包含字符串长度。 </span></span><br><span class="line"><span class="comment">例：s[]="hi baby"  t[]="baby"  index_bf_self(s,t,0); </span></span><br><span class="line"><span class="comment">index:在s中，从几号下标开始查找 </span></span><br><span class="line"><span class="comment">*/</span>  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">index_bf_self</span><span class="params">(<span class="keyword">char</span> *s,<span class="keyword">char</span> *t,<span class="keyword">int</span> index)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> i=index,j=<span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">while</span>(s[i]!=<span class="string">'\0'</span>)  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">while</span>(*(t+j)!=<span class="string">'\0'</span> &amp;&amp; *(s+i+j)!=<span class="string">'\0'</span>)  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">if</span>(*(t+j)!=*(s+i+j))  </span><br><span class="line">                <span class="keyword">break</span>;  </span><br><span class="line">            j++;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">if</span>(*(t+j)==<span class="string">'\0'</span>)  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">return</span> i;  </span><br><span class="line">        &#125;  </span><br><span class="line">        i++;  </span><br><span class="line">        j=<span class="number">0</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法十一-Aho-Corasick-算法"><a href="#方法十一-Aho-Corasick-算法" class="headerlink" title="方法十一: Aho-Corasick 算法"></a>方法十一: Aho-Corasick 算法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////////////////////////////////////////////////////    </span></span><br><span class="line"><span class="comment">/*  </span></span><br><span class="line"><span class="comment">程序说明：多模式串匹配的AC自动机算法  </span></span><br><span class="line"><span class="comment">自动机算法可以参考《柔性字符串匹配》里的相应章节，讲的很清楚  </span></span><br><span class="line"><span class="comment">*/</span>    </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;    </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;    </span></span></span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXQ = <span class="number">500000</span>+<span class="number">10</span>;    </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">1000000</span>+<span class="number">10</span>;    </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXK = <span class="number">26</span>; <span class="comment">//自动机里字符集的大小    </span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TrieNode</span>    </span></span><br><span class="line"><span class="class">&#123;</span>    </span><br><span class="line">       TrieNode* fail;    </span><br><span class="line">       TrieNode* next[MAXK];    </span><br><span class="line">       <span class="keyword">bool</span> danger;   <span class="comment">//该节点是否为某模式串的终结点    </span></span><br><span class="line">       <span class="keyword">int</span> cnt;    <span class="comment">//以该节点为终结点的模式串个数    </span></span><br><span class="line">       TrieNode()    </span><br><span class="line">       &#123;    </span><br><span class="line">              fail = <span class="literal">NULL</span>;    </span><br><span class="line">              <span class="built_in">memset</span>(next, <span class="literal">NULL</span>, <span class="keyword">sizeof</span>(next));    </span><br><span class="line">              danger = <span class="literal">false</span>;    </span><br><span class="line">              cnt = <span class="number">0</span>;    </span><br><span class="line">       &#125;    </span><br><span class="line">&#125;*que[MAXQ], *root;    </span><br><span class="line"><span class="comment">//文本字符串    </span></span><br><span class="line"><span class="keyword">char</span> msg[MAXN];    </span><br><span class="line"><span class="keyword">int</span>   N;    </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TrieInsert</span><span class="params">(<span class="keyword">char</span> *s)</span>    </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">       <span class="keyword">int</span> i = <span class="number">0</span>;    </span><br><span class="line">       TrieNode *ptr = root;    </span><br><span class="line">       <span class="keyword">while</span>(s[i])    </span><br><span class="line">       &#123;    </span><br><span class="line">              <span class="keyword">int</span> idx = s[i]-<span class="string">'a'</span>;    </span><br><span class="line">              <span class="keyword">if</span>(ptr-&gt;next[idx] == <span class="literal">NULL</span>)    </span><br><span class="line">                     ptr-&gt;next[idx] = <span class="keyword">new</span> TrieNode();    </span><br><span class="line">              ptr = ptr-&gt;next[idx];    </span><br><span class="line">              i++;    </span><br><span class="line">       &#125;    </span><br><span class="line">       ptr-&gt;danger = <span class="literal">true</span>;    </span><br><span class="line">       ptr-&gt;cnt++;    </span><br><span class="line">&#125;    </span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span>    </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">       <span class="keyword">int</span> i;    </span><br><span class="line">       <span class="keyword">char</span> s[<span class="number">100</span>];    </span><br><span class="line">       root = <span class="keyword">new</span> TrieNode();    </span><br><span class="line">       <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;N);    </span><br><span class="line">       <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; N; i++)    </span><br><span class="line">       &#123;    </span><br><span class="line">              <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);    </span><br><span class="line">              TrieInsert(s);    </span><br><span class="line">       &#125;    </span><br><span class="line">&#125;    </span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Build_AC_Automation</span><span class="params">()</span>    </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">       <span class="keyword">int</span> rear = <span class="number">1</span>, front = <span class="number">0</span>, i;    </span><br><span class="line">       que[<span class="number">0</span>] = root;    </span><br><span class="line">       root-&gt;fail = <span class="literal">NULL</span>;    </span><br><span class="line">       <span class="keyword">while</span>(rear != front)    </span><br><span class="line">       &#123;    </span><br><span class="line">              TrieNode *cur = que[front++];    </span><br><span class="line">              <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)    </span><br><span class="line">                     <span class="keyword">if</span>(cur-&gt;next[i] != <span class="literal">NULL</span>)    </span><br><span class="line">                     &#123;    </span><br><span class="line">                            <span class="keyword">if</span>(cur == root)    </span><br><span class="line">                                   cur-&gt;next[i]-&gt;fail = root;    </span><br><span class="line">                            <span class="keyword">else</span>    </span><br><span class="line">                            &#123;    </span><br><span class="line">                                   TrieNode *ptr = cur-&gt;fail;    </span><br><span class="line">                                   <span class="keyword">while</span>(ptr != <span class="literal">NULL</span>)    </span><br><span class="line">                                   &#123;    </span><br><span class="line">                                          <span class="keyword">if</span>(ptr-&gt;next[i] != <span class="literal">NULL</span>)    </span><br><span class="line">                                          &#123;    </span><br><span class="line">                                                 cur-&gt;next[i]-&gt;fail = ptr-&gt;next[i];    </span><br><span class="line">                                                 <span class="keyword">if</span>(ptr-&gt;next[i]-&gt;danger == <span class="literal">true</span>)    </span><br><span class="line">                                                        cur-&gt;next[i]-&gt;danger = <span class="literal">true</span>;    </span><br><span class="line">                                                 <span class="keyword">break</span>;    </span><br><span class="line">                                          &#125;    </span><br><span class="line">                                          ptr = ptr-&gt;fail;    </span><br><span class="line">                                   &#125;    </span><br><span class="line">                                   <span class="keyword">if</span>(ptr == <span class="literal">NULL</span>) cur-&gt;next[i]-&gt;fail = root;    </span><br><span class="line">                            &#125;    </span><br><span class="line">                            que[rear++] = cur-&gt;next[i];    </span><br><span class="line">                     &#125;    </span><br><span class="line">       &#125;    </span><br><span class="line">&#125;    </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">AC_Search</span><span class="params">()</span>    </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">       <span class="keyword">int</span> i = <span class="number">0</span>, ans = <span class="number">0</span>;    </span><br><span class="line">       TrieNode *ptr = root;    </span><br><span class="line">       <span class="keyword">while</span>(msg[i])    </span><br><span class="line">       &#123;    </span><br><span class="line">              <span class="keyword">int</span> idx = msg[i]-<span class="string">'a'</span>;    </span><br><span class="line">              <span class="keyword">while</span>(ptr-&gt;next[idx] == <span class="literal">NULL</span> &amp;&amp; ptr != root) ptr = ptr-&gt;fail;    </span><br><span class="line">              ptr = ptr-&gt;next[idx];    </span><br><span class="line">              <span class="keyword">if</span>(ptr == <span class="literal">NULL</span>) ptr = root;    </span><br><span class="line">              TrieNode *tmp = ptr;    </span><br><span class="line">              <span class="keyword">while</span>(tmp != <span class="literal">NULL</span> &amp;&amp; tmp-&gt;cnt != <span class="number">-1</span>)    </span><br><span class="line">              &#123;    </span><br><span class="line">                     ans += tmp-&gt;cnt;    </span><br><span class="line">                     tmp-&gt;cnt = <span class="number">-1</span>;    </span><br><span class="line">                     tmp = tmp-&gt;fail;    </span><br><span class="line">              &#125;    </span><br><span class="line">              i++;    </span><br><span class="line">       &#125;    </span><br><span class="line">       <span class="keyword">return</span> ans;    </span><br><span class="line">&#125;    </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>    </span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">       <span class="keyword">int</span> T;    </span><br><span class="line">       <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);    </span><br><span class="line">       <span class="keyword">while</span>(T--)    </span><br><span class="line">       &#123;    </span><br><span class="line">              Init();    </span><br><span class="line">              Build_AC_Automation();    </span><br><span class="line">              <span class="comment">//文本    </span></span><br><span class="line">              <span class="built_in">scanf</span>(<span class="string">"%s"</span>, msg);    </span><br><span class="line">              <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, AC_Search());    </span><br><span class="line">       &#125;    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="伪方法一-字符串转数组-取交集-判断结果"><a href="#伪方法一-字符串转数组-取交集-判断结果" class="headerlink" title="伪方法一: 字符串转数组, 取交集, 判断结果"></a>伪方法一: 字符串转数组, 取交集, 判断结果</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  字符串转数组, 取交集, 判断结果</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// demo</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xasfsdfbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'fbk'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'xs'</span>) != <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'match:'</span>, str_match(<span class="string">'xasfsdfbk'</span>, <span class="string">'sfs'</span>) !== <span class="keyword">false</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>, <span class="string">';'</span>, PHP_EOL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// code</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_match</span><span class="params">($a, $b)</span> </span>&#123;</span><br><span class="line">    $aArr = str_split($a);</span><br><span class="line">    $bArr = str_split($b);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> join(<span class="string">''</span>, array_intersect($aArr, $bArr)) == $b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 集合中的元素具有唯一性, 被匹配的字符串中有相同的字符, 将会去重</span></span><br><span class="line"><span class="comment">// 不能保证交集后的元素顺序连续</span></span><br></pre></td></tr></table></figure>
<h2 id="算法原理"><a href="#算法原理" class="headerlink" title="算法原理"></a>算法原理</h2><h3 id="算法一-Rabin-Karp算法-Karp-Rabin"><a href="#算法一-Rabin-Karp算法-Karp-Rabin" class="headerlink" title="算法一: Rabin-Karp算法(Karp-Rabin)"></a>算法一: Rabin-Karp算法(Karp-Rabin)</h3><p><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Rabin-Karp/Rabin-Karp-Basic-Principles.png?x-oss-process=style/all" alt="image"></p>
<p>Rabin-Karp 算法（也可以叫 Karp-Rabin 算法），由 Richard M. Karp 和 Michael O. Rabin 在 1987 年发表，它也是用来解决多模式串匹配问题的。</p>
<p>它的实现方式有点与众不同，首先是计算两个字符串的哈希值，然后通过比较这两个哈希值的大小来判断是否出现匹配。</p>
<p>选择一个合适的哈希函数很重要。假设文本串为<code>t[0, n)</code>，模式串为<code>p[0, m)</code>，其中 <code>0&lt;m&lt;n，Hash(t[i,j])</code> 代表字符串<code>t[i, j]</code>的哈希值。</p>
<p>当 <code>Hash(t[0, m-1])!=Hash(p[0,m-1])</code> 时，我们很自然的会把 <code>Hash(t[1, m])</code> 拿过来继续比较。在这个过程中，若我们重新计算字符串<code>t[1, m]</code>的哈希值，还需要 <code>O(n)</code> 的时间复杂度，不划算。观察到字符串<code>t[0, m-1]</code>与<code>t[1, m]</code>中有 <code>m-1</code> 个字符是重合的，因此我们可以选用滚动哈希函数，那么重新计算的时间复杂度就降为 <code>O(1)</code>。</p>
<p>Rabin-Karp 算法选用的滚动哈希函数主要是利用 <a href="https://en.wikipedia.org/wiki/Rabin_fingerprint" target="_blank" rel="noopener">Rabin fingerprint</a> 的思想，举个例子，计算字符串t[0, m - 1]的哈希值的公式如下，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hash(t[0,m-1]) = t[0]*bm-1 + t[1]*bm-2 + ... + t[m-1]*b0</span><br></pre></td></tr></table></figure>
<p>其中的 b 是一个常数，在 Rabin-Karp 算法中，我们一般取值为 256，因为一个字符的最大值不超过 255。上面的公式还有一个问题，哈希值如果过大可能会溢出，因此我们还需要对其取模，这个值应该尽可能大，且是质数，这样可以减小哈希碰撞的概率，在这里我们就取 101。</p>
<p>则计算字符串t[1, m]的哈希值公式如下，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hash(t[1,m]) = ( Hash(t[0,m−1]) − t[0]∗bm−1 ) ∗ b + t[m]∗b0</span><br></pre></td></tr></table></figure></p>
<p>如图, 算法导论上提供的示例图:<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Rabin-Karp/1.png?x-oss-process=style/all" alt="image"></p>
<h3 id="算法二-KMP算法-Knuth-Morris-Pratt"><a href="#算法二-KMP算法-Knuth-Morris-Pratt" class="headerlink" title="算法二: KMP算法(Knuth Morris Pratt)"></a>算法二: KMP算法(Knuth Morris Pratt)</h3><p>许多算法可以完成这个任务，Knuth-Morris-Pratt算法（简称KMP）是最常用的之一。它以三个发明者命名，起头的那个K就是著名科学家Donald Knuth。</p>
<p>这种算法不太容易理解，网上有很多解释，但读起来都很费劲。直到读到Jake Boxer的文章，才真正理解这种算法。下面是<a href="http://www.ruanyifeng.com/blog/2013/05/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm.html" target="_blank" rel="noopener">阮一峰</a>对KMP算法解释。</p>
<ol>
<li><p>首先，字符串”BBC ABCDAB ABCDABCDABDE”的第一个字符与搜索词”ABCDABD”的第一个字符，进行比较。因为B与A不匹配，所以搜索词后移一位。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-1.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>因为B与A不匹配，搜索词再往后移。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-2.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>就这样，直到字符串有一个字符，与搜索词的第一个字符相同为止。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-3.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>接着比较字符串和搜索词的下一个字符，还是相同。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-4.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>直到字符串有一个字符，与搜索词对应的字符不相同为止。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-5.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>这时，最自然的反应是，将搜索词整个后移一位，再从头逐个比较。这样做虽然可行，但是效率很差，因为你要把”搜索位置”移到已经比较过的位置，重比一遍。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-6.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>一个基本事实是，当空格与D不匹配时，你其实知道前面六个字符是”ABCDAB”。KMP算法的想法是，设法利用这个已知信息，不要把”搜索位置”移回已经比较过的位置，继续把它向后移，这样就提高了效率。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-7.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>怎么做到这一点呢？可以针对搜索词，算出一张《部分匹配表》（Partial Match Table）。这张表是如何产生的，后面再介绍，这里只要会用就可以了。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-8.png?x-oss-process=style/all" alt="image"></p>
</li>
</ol>
<p>9.已知空格与D不匹配时，前面六个字符”ABCDAB”是匹配的。查表可知，最后一个匹配字符B对应的”部分匹配值”为2，因此按照下面的公式算出向后移动的位数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">移动位数 = 已匹配的字符数 - 对应的部分匹配值</span><br></pre></td></tr></table></figure>
<p>因为 6 - 2 等于4，所以将搜索词向后移动4位。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-9.png?x-oss-process=style/all" alt="image"></p>
<ol>
<li><p>因为空格与Ｃ不匹配，搜索词还要继续往后移。这时，已匹配的字符数为2（”AB”），对应的”部分匹配值”为0。所以，移动位数 = 2 - 0，结果为 2，于是将搜索词向后移2位。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-10.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>因为空格与A不匹配，继续后移一位。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-11.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>逐位比较，直到发现C与D不匹配。于是，移动位数 = 6 - 2，继续将搜索词向后移动4位。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-12.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>逐位比较，直到搜索词的最后一位，发现完全匹配，于是搜索完成。如果还要继续搜索（即找出全部匹配），移动位数 = 7 - 0，再将搜索词向后移动7位，这里就不再重复了。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-13.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>下面介绍《部分匹配表》是如何产生的。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-14.png?x-oss-process=style/all" alt="image"></p>
</li>
</ol>
<p>首先，要了解两个概念：”前缀”和”后缀”。<br>“前缀”指除了最后一个字符以外，一个字符串的全部头部组合；”后缀”指除了第一个字符以外，一个字符串的全部尾部组合。</p>
<table>
<thead>
<tr>
<th>概念</th>
<th>描述</th>
<th>字符串示例 “bread”</th>
</tr>
</thead>
<tbody>
<tr>
<td>前缀</td>
<td>除了最后一个字符以外，一个字符串的全部头部组合</td>
<td>b, br, bre, brea</td>
</tr>
<tr>
<td>后缀</td>
<td>除了第一个字符以外，一个字符串的全部尾部组合</td>
<td>read, ead, ad, d</td>
</tr>
</tbody>
</table>
<ol>
<li>部分匹配值实例</li>
</ol>
<p><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-15.png?x-oss-process=style/all" alt="image"></p>
<p>“部分匹配值”就是”前缀”和”后缀”的最长的共有元素的长度。以”ABCDABD”为例，</p>
<table>
<thead>
<tr>
<th>字符串</th>
<th>前缀</th>
<th>后缀</th>
<th>共有元素</th>
<th>共有元素长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>[]</td>
<td>[]</td>
<td>[]</td>
<td>0</td>
</tr>
<tr>
<td>AB</td>
<td>[A]</td>
<td>[B]</td>
<td>[]</td>
<td>0</td>
</tr>
<tr>
<td>ABC</td>
<td>[A, AB]</td>
<td>[BC, C]</td>
<td>[]</td>
<td>0</td>
</tr>
<tr>
<td>ABCD</td>
<td>[A, AB, ABC]</td>
<td>[BCD, CD, D]</td>
<td>[]</td>
<td>0</td>
</tr>
<tr>
<td>ABCDA</td>
<td>[A, AB, ABC, ABCD]</td>
<td>[BCDA, CDA, DA, A]</td>
<td>[A]</td>
<td>1</td>
</tr>
<tr>
<td>ABCDAB</td>
<td>[A, AB, ABC, ABCD, ABCDA]</td>
<td>[BCDAB, CDAB, DAB, AB, B]</td>
<td>[AB]</td>
<td>2</td>
</tr>
<tr>
<td>ABCDABD</td>
<td>[A, AB, ABC, ABCD, ABCDA, ABCDAB]</td>
<td>[BCDABD, CDABD, DABD, ABD, BD, D]</td>
<td>[]</td>
<td>0</td>
</tr>
</tbody>
</table>
<ol>
<li>“部分匹配”的实质是，有时候，字符串头部和尾部会有重复。比如，”ABCDAB”之中有两个”AB”，那么它的”部分匹配值”就是2（”AB”的长度）。搜索词移动的时候，第一个”AB”向后移动4位（字符串长度-部分匹配值），就可以来到第二个”AB”的位置。</li>
</ol>
<p><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/KMP/KMP-16.png?x-oss-process=style/all" alt="image"></p>
<h3 id="算法三-Boyer-Moore算法"><a href="#算法三-Boyer-Moore算法" class="headerlink" title="算法三: Boyer-Moore算法"></a>算法三: Boyer-Moore算法</h3><p>KMP算法并不是效率最高的算法，实际采用并不多。各种文本编辑器的”查找”功能（Ctrl+F），大多采用Boyer-Moore算法。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-0.jpg?x-oss-process=style/all" alt="image"></p>
<p>Boyer-Moore算法不仅效率高，而且构思巧妙，容易理解。1977年，德克萨斯大学的Robert S. Boyer教授和J Strother Moore教授发明了这种算法。</p>
<p>下面是<a href="http://www.ruanyifeng.com/blog/2013/05/boyer-moore_string_search_algorithm.html" target="_blank" rel="noopener">阮一峰</a>根据Moore教授的例子对Boyer-Moore算法的解释。</p>
<ol>
<li><p>假定字符串为”HERE IS A SIMPLE EXAMPLE”，搜索词为”EXAMPLE”。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-1.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>首先，”字符串”与”搜索词”头部对齐，从尾部开始比较。</p>
</li>
</ol>
<p>这是一个很聪明的想法，因为如果尾部字符不匹配，那么只要一次比较，就可以知道前7个字符（整体上）肯定不是要找的结果。</p>
<p>我们看到，”S”与”E”不匹配。这时，”S”就被称为”坏字符”（bad character），即不匹配的字符。我们还发现，”S”不包含在搜索词”EXAMPLE”之中，这意味着可以把搜索词直接移到”S”的后一位。</p>
<p><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-2.png?x-oss-process=style/all" alt="image"></p>
<ol>
<li><p>依然从尾部开始比较，发现”P”与”E”不匹配，所以”P”是”坏字符”。但是，”P”包含在搜索词”EXAMPLE”之中。所以，将搜索词后移两位，两个”P”对齐。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-3.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>我们由此总结出”坏字符规则”：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">后移位数 = 坏字符的位置 - 搜索词中的上一次出现位置</span><br></pre></td></tr></table></figure>
<p>如果”坏字符”不包含在搜索词之中，则上一次出现位置为 -1。</p>
<p>以”P”为例，它作为”坏字符”，出现在搜索词的第6位（从0开始编号），在搜索词中的上一次出现位置为4，所以后移 6 - 4 = 2位。再以前面第二步的”S”为例，它出现在第6位，上一次出现位置是 -1（即未出现），则整个搜索词后移 6 - (-1) = 7位。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-4.png?x-oss-process=style/all" alt="image"></p>
<ol>
<li><p>依然从尾部开始比较，”E”与”E”匹配。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-5.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>比较前面一位，”LE”与”LE”匹配。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-6.png?x-oss-process=style/all" alt="image"></p>
</li>
</ol>
<ol>
<li>比较前面一位，”PLE”与”PLE”匹配。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-7.png?x-oss-process=style/all" alt="image"></li>
</ol>
<ol>
<li><p>比较前面一位，”MPLE”与”MPLE”匹配。我们把这种情况称为”好后缀”（good suffix），即所有尾部匹配的字符串。注意，”MPLE”、”PLE”、”LE”、”E”都是好后缀。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-8.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>比较前一位，发现”I”与”A”不匹配。所以，”I”是”坏字符”。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-9.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>根据”坏字符规则”，此时搜索词应该后移 2 - （-1）= 3 位。问题是，此时有没有更好的移法？<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-10.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>我们知道，此时存在”好后缀”。所以，可以采用”好后缀规则”：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">后移位数 = 好后缀的位置 - 搜索词中的上一次出现位置</span><br></pre></td></tr></table></figure>
<p>举例来说，如果字符串”ABCDAB”的后一个”AB”是”好后缀”。那么它的位置是5（从0开始计算，取最后的”B”的值），在”搜索词中的上一次出现位置”是1（第一个”B”的位置），所以后移 5 - 1 = 4位，前一个”AB”移到后一个”AB”的位置。</p>
<p>再举一个例子，如果字符串”ABCDEF”的”EF”是好后缀，则”EF”的位置是5 ，上一次出现的位置是 -1（即未出现），所以后移 5 - (-1) = 6位，即整个字符串移到”F”的后一位。</p>
<p>这个规则有三个注意点：</p>
<ul>
<li><p>（1）”好后缀”的位置以最后一个字符为准。假定”ABCDEF”的”EF”是好后缀，则它的位置以”F”为准，即5（从0开始计算）。</p>
</li>
<li><p>（2）如果”好后缀”在搜索词中只出现一次，则它的上一次出现位置为 -1。比如，”EF”在”ABCDEF”之中只出现一次，则它的上一次出现位置为-1（即未出现）。</p>
</li>
<li><p>（3）如果”好后缀”有多个，则除了最长的那个”好后缀”，其他”好后缀”的上一次出现位置必须在头部。比如，假定”BABCDAB”的”好后缀”是”DAB”、”AB”、”B”，请问这时”好后缀”的上一次出现位置是什么？回答是，此时采用的好后缀是”B”，它的上一次出现位置是头部，即第0位。这个规则也可以这样表达：如果最长的那个”好后缀”只出现一次，则可以把搜索词改写成如下形式进行位置计算”(DA)BABCDAB”，即虚拟加入最前面的”DA”。</p>
</li>
</ul>
<p>回到上文的这个例子。此时，所有的”好后缀”（MPLE、PLE、LE、E）之中，只有”E”在”EXAMPLE”还出现在头部，所以后移 6 - 0 = 6位。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-11.png?x-oss-process=style/all" alt="image"></p>
<p>12.可以看到，”坏字符规则”只能移3位，”好后缀规则”可以移6位。所以，Boyer-Moore算法的基本思想是，每次后移这两个规则之中的较大值。</p>
<p>更巧妙的是，这两个规则的移动位数，只与搜索词有关，与原字符串无关。因此，可以预先计算生成《坏字符规则表》和《好后缀规则表》。使用时，只要查表比较一下就可以了。</p>
<p><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-12.png?x-oss-process=style/all" alt="image"></p>
<ol>
<li><p>继续从尾部开始比较，”P”与”E”不匹配，因此”P”是”坏字符”。根据”坏字符规则”，后移 6 - 4 = 2位。<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-13.png?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>从尾部开始逐位比较，发现全部匹配，于是搜索结束。如果还要继续查找（即找出全部匹配），则根据”好后缀规则”，后移 6 - 0 = 6位，即头部的”E”移到尾部的”E”的位置。</p>
</li>
</ol>
<p><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Boyer-Moore/Boyer-Moore-14.png?x-oss-process=style/all" alt="image"></p>
<h3 id="算法四-Sunday算法"><a href="#算法四-Sunday算法" class="headerlink" title="算法四: Sunday算法"></a>算法四: Sunday算法</h3><p>Sunday算法由Daniel M.Sunday在1990年提出，它的思想跟BM算法很相似：1</p>
<p>只不过Sunday算法是从前往后匹配，在匹配失败时关注的是主串中参加匹配的最末位字符的下一位字符。</p>
<p>如果该字符没有在模式串中出现则直接跳过，即移动位数 = 模式串长度 + 1；<br>否则，其移动位数 = 模式串长度 - 该字符最右出现的位置(以0开始) = 模式串中该字符最右出现的位置到尾部的距离 + 1。<br>下面举个例子说明下Sunday算法。假定现在要在主串”substring searching”中查找模式串”search”。</p>
<p>刚开始时，把模式串与文主串左边对齐：<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/sunday/sunday-1.jpg?x-oss-process=style/all" alt="image"></p>
<p>结果发现在第2个字符处发现不匹配，不匹配时关注主串中参加匹配的最末位字符的下一位字符，即标粗的字符 i，因为模式串search中并不存在i，所以模式串直接跳过一大片，向右移动位数 = 匹配串长度 + 1 = 6 + 1 = 7，从 i 之后的那个字符（即字符n）开始下一步的匹配，如下图：<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/sunday/sunday-2.jpg?x-oss-process=style/all" alt="image"></p>
<p>结果第一个字符就不匹配，再看主串中参加匹配的最末位字符的下一位字符，是’r’，它出现在模式串中的倒数第3位，于是把模式串向右移动3位（m - 3 = 6 - 3 = r 到模式串末尾的距离 + 1 = 2 + 1 =3），使两个’r’对齐，如下：<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/sunday/sunday-3.jpg?x-oss-process=style/all" alt="image"></p>
<p>匹配成功。</p>
<p>回顾整个过程，我们只移动了两次模式串就找到了匹配位置，缘于Sunday算法每一步的移动量都比较大，效率很高。</p>
<h3 id="算法五-BF算法-Brute-Force"><a href="#算法五-BF算法-Brute-Force" class="headerlink" title="算法五: BF算法(Brute Force)"></a>算法五: BF算法(Brute Force)</h3><p>BF算法核心思想是：首先S[1]和T[1]比较，若相等，则再比较S[2]和T[2]，一直到T[M]为止；若S[1]和T[1]不等，则T向右移动一个字符的位置，再依次进行比较。如果存在k，1≤k≤N，且S[k+1…k+M]=T[1…M]，则匹配成功；否则失败。该算法最坏情况下要进行M<em>(N-M+1)次比较，时间复杂度为O(M</em>N)。下面结合图片，解释一下：</p>
<p><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Brute-Force.png?x-oss-process=style/all" alt="Brute-Force"></p>
<p>S代表源字符串，T代表我们要查找的字符串。BF算法可以表述如下：依次遍历字符串S，看是否字符串S中含有字符串T。</p>
<p>因此，我们依次比较S[0] 和T[0]、S[1] 和T[1]、S[2] 和T[2]……S[n]和T[n] ，从图中我们可知，S[0]-S[7]和T[0]-T[7]依次相等。当匹配到S[8]和T[8]时，两个字符不等。根据定义，此时S和T都要回溯，T向右移动一个字符的位置，即S回溯到S[1]的位置，T回溯到T[0]的位置，再重新开始比较。此时，S[1]和T[0]、S[2]和T[1]……如果再次发现不匹配字符，则再次回溯，即S回溯到S[2]的位置，T回到T[0]的位置。循环往复，直到到达S或者T字符串的结尾。如果是到达S串的结尾，则表示匹配失败，如果是到达T串的结尾，则表示匹配成功。</p>
<p>BF算法优点：思想简单，直接，无需对字符串S和T进行预处理。缺点：每次字符不匹配时，都要回溯到开始位置，时间开销大。</p>
<h3 id="算法六-Aho-Corasick算法"><a href="#算法六-Aho-Corasick算法" class="headerlink" title="算法六: Aho-Corasick算法"></a>算法六: Aho-Corasick算法</h3><p>Aho-Corasick算法又叫AC自动机算法，是一种多模式匹配算法。Aho-Corasick算法可以在目标串查找多个模式串，出现次数以及出现的位置。</p>
<p>Aho-Corasick算法主要是应用有限自动机的状态转移来模拟字符的比较，下面对有限状态机做几点说明<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Aho-Corasick/Aho-Corasick-1.png?x-oss-process=style/all" alt="image"><br>上图是由多模式串{he,she,his,hers}构成的一个有限状态机：</p>
<p>1.该状态当字符匹配是按实线标注的状态进行转换，当所有实线路径都不满足（即下一个字符都不匹配时）按虚线状态进行转换。</p>
<p>2.对ushers匹配过程如下图所示：<br> <img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Aho-Corasick/Aho-Corasick-2.jpg?x-oss-process=style/all" alt="image"></p>
<p>当转移到红色结点时表示已经匹配并且获得模式串</p>
<p>Aho-Corasick算法步骤</p>
<p>Aho-Corasick算法和前面的算法一样都要对模式串进行预处理，预处理主要包括字典树Tire的构造，构建状态转移表（goto），失效函数（failure function），输出表（Output）。</p>
<p>Aho-Corasick算法包括以下3个步骤</p>
<ol>
<li>构建字典树Tire</li>
<li>构建状态转移表，失效函数（failure function），输出表（Output）</li>
<li>搜索路径（进行匹配）</li>
</ol>
<p>下面3个步骤分别进行介绍</p>
<ol>
<li><p>构建字典树Tire<br>Tire是哈希树的变种，Tire树的边是模式串的字符，结点就是Tire的状态表，下图是多模式串{he,she,his,hers}的Tire树结构：<br><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Aho-Corasick/Aho-Corasick-3.jpg?x-oss-process=style/all" alt="image"></p>
</li>
<li><p>构建goto函数、failure function和Output函数             </p>
</li>
</ol>
<ul>
<li>goto函数（状态转移函数）：goto(pre,v)=next,完成这样的任务：在当前状态pre，输入字符v，得到下一个状态next，如果没有下个状态则next=failure。                  </li>
<li>failure function：失效函数是处理当前状态是failure时的处理。             </li>
<li>output函数：当完成匹配是根据状态输出匹配的模式串。</li>
</ul>
<p>下面是多模式串{he,she,his,hers}的goto函数，failure函数，output函数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>结构图</th>
</tr>
</thead>
<tbody>
<tr>
<td>goto函数</td>
<td><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Aho-Corasick/Aho-Corasick-goto.png?x-oss-process=style/all" alt="image"></td>
</tr>
<tr>
<td>failure函数</td>
<td><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Aho-Corasick/Aho-Corasick-failure.png?x-oss-process=style/all" alt="image"></td>
</tr>
<tr>
<td>output函数</td>
<td><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Aho-Corasick/Aho-Corasick-output.png?x-oss-process=style/all" alt="image"></td>
</tr>
</tbody>
</table>
<ol>
<li><p>多模式串{he,she,his,hers}最终的有限状态机图</p>
<p><img src="https://xynoss.oss-cn-beijing.aliyuncs.com/youdao/Aho-Corasick/Aho-Corasick-m.jpg?x-oss-process=style/all" alt="image"></p>
</li>
</ol>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>一般而言，好的字符串匹配算法要有以下特点:</p>
<h3 id="速度快"><a href="#速度快" class="headerlink" title="速度快"></a>速度快</h3><p>这是评价一个字符匹配算法最重要的标准。通常要求字符匹配能以线性速度执行。</p>
<ul>
<li><h4 id="有几种时间复杂性的评价指标"><a href="#有几种时间复杂性的评价指标" class="headerlink" title="有几种时间复杂性的评价指标"></a>有几种时间复杂性的评价指标</h4>序号 | 指标 | 描述<br>—|—|—<br>1) |预处理时间的复杂性 | 有些算法在进行字符串匹配前需要对模式特征进行预处理<br>2) | 匹配阶段的时间复杂性 | 字符串匹配过程中执行查找操作的时间复杂性，它通常和文本长度及模式长度相关<br>3) | 最坏情况下的时间复杂性 | 对一个text进行字符模式匹配时，设法降低各算法的最坏情况下的时间复杂性是目前的研究热点之一<br>4) | 最好情况下的时间复杂性 | 对一个text进行字符模式匹配时的最好的可能性。</li>
</ul>
<h3 id="内存占用少"><a href="#内存占用少" class="headerlink" title="内存占用少"></a>内存占用少</h3><p>执行预处理和模式匹配不仅需要CPU资源还需要内存资源，尽管目前内存的容量较以前大得多，但为了提高速度，人们常利用特殊硬件。通常，特殊硬件中内存访问速度很快但容量偏小，这时，占用资源少的算法将更具优势。 </p>
<h2 id="PHP-strpos-分析"><a href="#PHP-strpos-分析" class="headerlink" title="PHP(strpos)分析"></a>PHP(strpos)分析</h2><h3 id="strpos-ext-standard-string-c"><a href="#strpos-ext-standard-string-c" class="headerlink" title="strpos(ext/standard/string.c)"></a>strpos(ext/standard/string.c)</h3><ul>
<li><a href="https://github.com/php/php-src/blob/master/ext/standard/string.c" target="_blank" rel="noopener">PHP源码地址</a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">PHP_FUNCTION(strpos)</span><br><span class="line">&#123;</span><br><span class="line">	zval *needle;</span><br><span class="line">	zend_string *haystack;</span><br><span class="line">	<span class="keyword">char</span> *found = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">char</span>  needle_char[<span class="number">2</span>];</span><br><span class="line">	zend_long  offset = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> FAST_ZPP</span></span><br><span class="line">	<span class="keyword">if</span> (zend_parse_parameters(ZEND_NUM_ARGS(), <span class="string">"Sz|l"</span>, &amp;haystack, &amp;needle, &amp;offset) == FAILURE) &#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">	ZEND_PARSE_PARAMETERS_START(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">		Z_PARAM_STR(haystack)</span><br><span class="line">		Z_PARAM_ZVAL(needle)</span><br><span class="line">		Z_PARAM_OPTIONAL</span><br><span class="line">		Z_PARAM_LONG(offset)</span><br><span class="line">	ZEND_PARSE_PARAMETERS_END();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (offset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		offset += (zend_long)ZSTR_LEN(haystack);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (offset &lt; <span class="number">0</span> || (<span class="keyword">size_t</span>)offset &gt; ZSTR_LEN(haystack)) &#123;</span><br><span class="line">		php_error_docref(<span class="literal">NULL</span>, E_WARNING, <span class="string">"Offset not contained in string"</span>);</span><br><span class="line">		RETURN_FALSE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (Z_TYPE_P(needle) == IS_STRING) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!Z_STRLEN_P(needle)) &#123;</span><br><span class="line">			php_error_docref(<span class="literal">NULL</span>, E_WARNING, <span class="string">"Empty needle"</span>);</span><br><span class="line">			RETURN_FALSE;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		found = (<span class="keyword">char</span>*)php_memnstr(ZSTR_VAL(haystack) + offset,</span><br><span class="line">			                Z_STRVAL_P(needle),</span><br><span class="line">			                Z_STRLEN_P(needle),</span><br><span class="line">			                ZSTR_VAL(haystack) + ZSTR_LEN(haystack));</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (php_needle_char(needle, needle_char) != SUCCESS) &#123;</span><br><span class="line">			RETURN_FALSE;</span><br><span class="line">		&#125;</span><br><span class="line">		needle_char[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		found = (<span class="keyword">char</span>*)php_memnstr(ZSTR_VAL(haystack) + offset,</span><br><span class="line">							needle_char,</span><br><span class="line">							<span class="number">1</span>,</span><br><span class="line">		                    ZSTR_VAL(haystack) + ZSTR_LEN(haystack));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (found) &#123;</span><br><span class="line">		RETURN_LONG(found - ZSTR_VAL(haystack));</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		RETURN_FALSE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="php-memnstr-main-php-h"><a href="#php-memnstr-main-php-h" class="headerlink" title="php_memnstr(main/php.h)"></a>php_memnstr(main/php.h)</h3><ul>
<li><a href="https://github.com/php/php-src/blob/master/main/php.h" target="_blank" rel="noopener">PHP源码地址</a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> php_memnstr zend_memnstr <span class="comment">/* 338 line*/</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="zend-memnstr-Zend-zend-operators-h"><a href="#zend-memnstr-Zend-zend-operators-h" class="headerlink" title="zend_memnstr(Zend/zend_operators.h)"></a>zend_memnstr(Zend/zend_operators.h)</h3><ul>
<li><a href="https://github.com/php/php-src/blob/master/Zend/zend_operators.h" target="_blank" rel="noopener">PHP源码地址</a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 此函数的作用是在haystack中查找needle,如果不存在返回null,如果存在，返回指向haystack中needle头字符的指针</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">zend_memnstr(<span class="keyword">const</span> <span class="keyword">char</span> *haystack, <span class="keyword">const</span> <span class="keyword">char</span> *needle, <span class="keyword">size_t</span> needle_len, <span class="keyword">const</span> <span class="keyword">char</span> *end)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> *p = haystack;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">char</span> ne = needle[needle_len<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">ptrdiff_t</span> off_p;</span><br><span class="line">	<span class="keyword">size_t</span> off_s;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (needle_len == <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">const</span> <span class="keyword">char</span> *)<span class="built_in">memchr</span>(p, *needle, (end-p));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	off_p = end - haystack;</span><br><span class="line">	off_s = (off_p &gt; <span class="number">0</span>) ? (<span class="keyword">size_t</span>)off_p : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (needle_len &gt; off_s) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (EXPECTED(off_s &lt; <span class="number">1024</span> || needle_len &lt; <span class="number">3</span>)) &#123;</span><br><span class="line">	    <span class="comment">// 第一个优化，只查找end - needle_len次</span></span><br><span class="line">		end -= needle_len;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (p &lt;= end) &#123;</span><br><span class="line">		    <span class="comment">// 第二个优化，先判断字符串的开头和结尾是否一样再判断整个字符串</span></span><br><span class="line">			<span class="keyword">if</span> ((p = (<span class="keyword">const</span> <span class="keyword">char</span> *)<span class="built_in">memchr</span>(p, *needle, (end-p+<span class="number">1</span>))) &amp;&amp; ne == p[needle_len<span class="number">-1</span>]) &#123;</span><br><span class="line">				<span class="keyword">if</span> (!<span class="built_in">memcmp</span>(needle, p, needle_len<span class="number">-1</span>)) &#123;</span><br><span class="line">					<span class="keyword">return</span> p;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			p++;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> zend_memnstr_ex(haystack, needle, needle_len, end);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="memchr-string-h"><a href="#memchr-string-h" class="headerlink" title="memchr(string.h)"></a>memchr(string.h)</h3><ul>
<li><a href="https://github.com/torvalds/linux/blob/master/lib/string.c" target="_blank" rel="noopener">Linux内核版-源码地址</a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">头文件：#include &lt;string.h&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">定义函数：void * memchr(const void *s, char c, size_t n);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">函数说明：memchr()从头开始搜寻s 所指的内存内容前n 个字节，直到发现第一个值为c 的字节，则返回指向该字节的指针。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">返回值：如果找到指定的字节则返回该字节的指针，否则返回0。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __HAVE_ARCH_MEMCHR</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">memchr</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *s, <span class="keyword">int</span> c, <span class="keyword">size_t</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *p = s;</span><br><span class="line">	<span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">        	<span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">char</span>)c == *p++) &#123;</span><br><span class="line">			<span class="keyword">return</span> (<span class="keyword">void</span> *)(p - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(<span class="built_in">memchr</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="memcmp-string-h"><a href="#memcmp-string-h" class="headerlink" title="memcmp(string.h)"></a>memcmp(string.h)</h3><ul>
<li><a href="https://github.com/torvalds/linux/blob/master/lib/string.c" target="_blank" rel="noopener">Linux内核版-源码地址</a><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 字符串函数memcmp</span></span><br><span class="line"><span class="comment">   原型：extern int memcmp(void *buf1, void *buf2, unsigned int count); </span></span><br><span class="line"><span class="comment">   功能：比较内存区域buf1和buf2的前count个字节</span></span><br><span class="line"><span class="comment">   说明：当buf1&lt;buf2时，返回值&lt;0 　</span></span><br><span class="line"><span class="comment">   　     当buf1=buf2时，返回值=0 　　</span></span><br><span class="line"><span class="comment">         当buf1&gt;buf2时，返回值&gt;0                                        </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __HAVE_ARCH_MEMCMP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">undef</span> memcmp</span></span><br><span class="line">__<span class="function">visible <span class="keyword">int</span> <span class="title">memcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *cs, <span class="keyword">const</span> <span class="keyword">void</span> *ct, <span class="keyword">size_t</span> count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> *su1, *su2;</span><br><span class="line">	<span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (su1 = cs, su2 = ct; <span class="number">0</span> &lt; count; ++su1, ++su2, count--)</span><br><span class="line">		<span class="keyword">if</span> ((res = *su1 - *su2) != <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">EXPORT_SYMBOL(<span class="built_in">memcmp</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/24649304" target="_blank" rel="noopener">算法之字符串模式匹配</a></li>
<li><a href="http://daizuozhuo.github.io/KMP/" target="_blank" rel="noopener">彻底搞定KMP字符串匹配算法</a></li>
<li><a href="http://blog.jobbole.com/107607/" target="_blank" rel="noopener">浅谈字符串匹配算法—BF 算法及 KMP 算法</a></li>
<li><a href="http://mingxinglai.com/cn/2013/08/pattern-match/" target="_blank" rel="noopener">几种常见的字符串匹配算法</a></li>
<li><a href="https://www.cnblogs.com/linbingdong/p/6479537.html" target="_blank" rel="noopener">字符串查找算法总结（暴力匹配、KMP 算法、Boyer-Moore 算法和 Sunday 算法）</a></li>
<li><a href="https://www.cnblogs.com/gaochundong/p/string_matching.html" target="_blank" rel="noopener">字符串匹配算法</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2013/05/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm.html" target="_blank" rel="noopener">字符串匹配的KMP算法</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2013/05/boyer-moore_string_search_algorithm.html" target="_blank" rel="noopener">字符串匹配的Boyer-Moore算法</a></li>
<li><a href="https://www.jianshu.com/p/0267b76368d1" target="_blank" rel="noopener">KMP算法心得</a></li>
<li><a href="https://blog.csdn.net/v_july_v/article/details/7041827" target="_blank" rel="noopener">从头到尾彻底理解KMP</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jianyong.github.io/2018/07/20/深入理解PHP之foreach/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jianyong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="行易难">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/20/深入理解PHP之foreach/" itemprop="url">深入理解PHP之foreach</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-20T23:46:38+08:00">
                2018-07-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://php.net/manual/zh/control-structures.foreach.php" target="_blank" rel="noopener">foreach</a> 语法结构提供了遍历数组的简单方式。</p>
<p>php5之前, foreach仅能用于数组<br>php5+, 利用foreach可以遍历对象</p>
<p>foreach仅能够应用于数据和对象，如果尝试应用于其他数据类型的变量，或者未初始化的变量将发出错误信息。</p>
<p>有两种语法：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  遍历给定的 array_expression 数据。每次循环中， 当前单元的值被赋给$value并且数组内部的指针向前移一步（因此下次循环中将会得到下一个单元）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">foreach</span> (array_expression <span class="keyword">as</span> $value) &#123;</span><br><span class="line">    <span class="comment">// statement</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (array_expression <span class="keyword">as</span> $value) :</span><br><span class="line">    <span class="comment">// statement</span></span><br><span class="line"><span class="keyword">endforeach</span>;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  同上，只除了当前单元格的键名也会在每次循环中被赋给变量$key</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">foreach</span> (array_expression <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="comment">// statement</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (array_expression <span class="keyword">as</span> $key =&gt; $value) :</span><br><span class="line">    <span class="comment">// statement</span></span><br><span class="line"><span class="keyword">endforeach</span>;</span><br></pre></td></tr></table></figure>
<p>还能够自定义遍历对象!</p>
<blockquote>
<p>当<code>foreach</code>开始执行时, 数组内部的指针会自动指向第一个单元. 这意味着不需要在<code>foreach</code>循环之前调用<code>reset()</code><br>由于<code>foreach</code>依赖内部数组指针, 在循环中修改其值将可能导致意外的行为</p>
</blockquote>
<p>可以很容易通过在 $value 之前加上 &amp; 来修改数组元素. 此方法将以<code>引用</code> 赋值, 而不是拷贝一个值.<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">foreach</span>($arr <span class="keyword">as</span> &amp;$value) &#123;</span><br><span class="line">    $value = $value * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// $arr is now [2, 4, 6, 8]</span></span><br><span class="line"><span class="keyword">unset</span>($value); <span class="comment">// 最后取消掉引用</span></span><br></pre></td></tr></table></figure></p>
<p><code>$value</code>的引用仅在被遍历的数组可以被引用时才可用(例如是个变量)。</p>
<p>以下代码无法运行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">/*</span><br><span class="line">  此段代码可以运行</span><br><span class="line">  运行结果:</span><br><span class="line">    1-2</span><br><span class="line">    2-4</span><br><span class="line">    3-6</span><br><span class="line">    4-8</span><br><span class="line">*/</span><br><span class="line">foreach (array(1, 2, 3, 4) as &amp;$value) &#123;</span><br><span class="line">    echo $value, &apos;-&apos;;</span><br><span class="line">    $value = $value * 2;</span><br><span class="line">    echo $value, PHP_EOL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Warning: 数组最后一个元素的 <code>$value</code> 引用在 <code>foreach</code> 循环之后仍会保留。建议使用 <code>unset()</code> 来将其销毁。</p>
<p>Note: <code>foreach</code> 不支持用 <code>@</code> 来抑制错误信息的能力</p>
</blockquote>
<h3 id="PHP7-新特性-foreach-修改"><a href="#PHP7-新特性-foreach-修改" class="headerlink" title="PHP7 新特性 foreach 修改"></a>PHP7 新特性 foreach 修改</h3><ul>
<li style="list-style: none"><input type="checkbox" checked> <code>foreach</code> 循环对数组内部指针不再起作用, 在PHP7之前, 当数据通过foreach迭代时, 数组指针会移动。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$array = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">foreach</span> ($array <span class="keyword">as</span> &amp;$val) &#123;</span><br><span class="line">    var_dump(current($array));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<table>
<thead>
<tr>
<th>版本</th>
<th>结果</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHP5</td>
<td>int(1) int(2) bool(false)</td>
<td>数组指针会移动</td>
</tr>
<tr>
<td>PHP7</td>
<td>int(0) int(0) int(0)</td>
<td>数据指针不再移动</td>
</tr>
</tbody>
</table>
<ul>
<li style="list-style: none"><input type="checkbox" checked> 按照值进行循环时, 对数组的修改是不会影响循环。</li>
</ul>
<p><code>foreach</code>按照值进行循环的时候(by-value), foreach是对该数组的一个拷贝进行操作. 所以在循环过程中修改不影响循环结果</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">$ref = &amp;$arr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $val) &#123;</span><br><span class="line">    var_dump($val);</span><br><span class="line">    <span class="keyword">unset</span>($arr[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>版本</th>
<th>结果</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHP5</td>
<td>int(0) int(2)</td>
<td>会将unset的数据跳过</td>
</tr>
<tr>
<td>PHP7</td>
<td>int(0) int(1) int(2)</td>
<td>对数组的改动不影响循环</td>
</tr>
</tbody>
</table>
<ul>
<li style="list-style: none"><input type="checkbox" checked> 按照引用进行循环的时候, 对数组的修改会影响循环<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">$ref = &amp;$arr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> &amp;$val) &#123;</span><br><span class="line">    var_dump($val);</span><br><span class="line">    <span class="keyword">unset</span>($arr[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<table>
<thead>
<tr>
<th>版本</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHP5</td>
<td>int(0) int(2)</td>
</tr>
<tr>
<td>PHP7</td>
<td>int(0) int(2)</td>
</tr>
</tbody>
</table>
<ul>
<li style="list-style: none"><input type="checkbox" checked> 对简单对象plain(non-Traversable)的循环</li>
<li><p>在简单对象的循环, 不管是按照值循环还是引用循环, 和按照引用对数组循环的行为是一样的, 不过对位置的管理会更加精确</p>
</li>
<li><p>[x] 对迭代对象(Traversable objects)对象行为和之前一致</p>
</li>
</ul>
<p><code>stackoverflow</code> 上面的解释, Traversable objects is one that implements Iterator or IteratorAggregate interface</p>
<p>如果一个对象实现了 <code>Iterator</code> 或者 <code>IteratorAggregate</code> 接口, 即可称之为迭代对象</p>
<hr>
<p>foreach 虽然简单, 不过它可能出现一些意外行为， 特别是代码涉及到引用的时候。</p>
<h3 id="问题一-如下代码运行结果为何不是-2-4-6"><a href="#问题一-如下代码运行结果为何不是-2-4-6" class="headerlink" title="问题一: 如下代码运行结果为何不是 2/4/6 ?"></a>问题一: 如下代码运行结果为何不是 2/4/6 ?</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; &amp;$v) &#123;</span><br><span class="line">    $v = $v * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $v, PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出:</span></span><br><span class="line"><span class="comment">    2</span></span><br><span class="line"><span class="comment">    4</span></span><br><span class="line"><span class="comment">    4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>我们可以认为 <code>foreach($arr as &amp;$v)</code> 结构隐含了如下操作, 分别将数组当前的 <code>键</code> 和 <code>值</code> 赋值给 <code>$k</code> 和 <code>$v</code>. 具体展开形如:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">foreach ($arr as $k =&gt; $v) &#123;</span><br><span class="line">    $k = currentKey();</span><br><span class="line">    $v = currentVal();</span><br><span class="line">    // 继续运行用户代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>根据上述理论, 现在我们重新来分析下第一个<code>foreach</code>:<br>循环 | 备注 | $arr值<br>—|—|—<br>循环 1-1 | 由于<code>$v</code>是一个引用, 因此 <code>$v = &amp;$arr[0]</code>, <code>$v = $v * 2</code> 相当于 <code>$arr[0] * 2</code> | [2, 2, 3]<br>循环 1-2 | <code>$v = &amp;$arr[1]</code> | [2, 4, 3]<br>循环 1-3 | <code>$v = &amp;$arr[2]</code> | [2, 4, 6]<br>循环 2-1 | 隐含操作 <code>$v = $arr[0]</code> 被触发, 由于此时 <code>$v</code> 仍是 <code>$arr[2]</code> 的引用, 相当于 <code>$arr[2] = $arr[0]</code> | [2, 4, 2]<br>循环 2-2 | <code>$v = $arr[1]</code>, 即<code>$arr[2] = $arr[1]</code> | [2, 4, 4]<br>循环 2-3 | <code>$v = $arr[2]</code>, 即<code>$arr[2] = $arr[2]</code> | [2, 4, 4]</p>
<p>如何解决此类问题呢? PHP手册上有一段提醒:</p>
<blockquote>
<p>Warning: 数组最后一个元素的 $value 引用在 foreach 循环之后仍会保留。建议使用 unset() 来将其销毁。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; &amp;$v) &#123;</span><br><span class="line">    $v = $v * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unset</span>($v);</span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">    <span class="keyword">echo</span> $v, PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出:</span></span><br><span class="line"><span class="comment">    2</span></span><br><span class="line"><span class="comment">    4</span></span><br><span class="line"><span class="comment">    6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>从这个问题可以看出, 引用很可能会伴随副作用。如果不希望无意识的修改导致数据内容变更， 最好及时unset掉这些引用。</p>
<h3 id="问题二-如下代码运行结果为何不是-0-gt-a-1-gt-b-2-gt-c"><a href="#问题二-如下代码运行结果为何不是-0-gt-a-1-gt-b-2-gt-c" class="headerlink" title="问题二: 如下代码运行结果为何不是 0=&gt;a 1=&gt;b 2=&gt;c"></a>问题二: 如下代码运行结果为何不是 0=&gt;a 1=&gt;b 2=&gt;c</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">    <span class="keyword">echo</span> key($arr), <span class="string">"=&gt;"</span>, current($arr), PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; &amp;$v) &#123;</span><br><span class="line">    <span class="keyword">echo</span> key($arr), <span class="string">"=&gt;"</span>, current($arr), PHP_EOL;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#php5.6</span></span><br><span class="line"><span class="comment">1=&gt;b 1=&gt;b 1=&gt;b</span></span><br><span class="line"><span class="comment">1=&gt;b 2=&gt;c =&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#php7</span></span><br><span class="line"><span class="comment">0=&gt;a 0=&gt;a 0=&gt;a</span></span><br><span class="line"><span class="comment">0=&gt;a 0=&gt;a 0=&gt;a</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>按照手册中的说法, key和current分别是获取数据中当前元素的键值。<br>那为何 <code>key($arr)</code> 一直是0，<code>current($arr)</code> 一直是’a’呢？</p>
<p>先用vld查看编译后的 <code>opcode</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">➜  demo /usr/local/Cellar/php/7.2.7/bin/php -dvld.active=1 a.php</span><br><span class="line">Finding entry points</span><br><span class="line">Branch analysis from position: 0</span><br><span class="line">Jump found. (Code = 77) Position 1 = 2, Position 2 = 15</span><br><span class="line">Branch analysis from position: 2</span><br><span class="line">Jump found. (Code = 78) Position 1 = 3, Position 2 = 15</span><br><span class="line">Branch analysis from position: 3</span><br><span class="line">Jump found. (Code = 42) Position 1 = 2</span><br><span class="line">Branch analysis from position: 2</span><br><span class="line">Branch analysis from position: 15</span><br><span class="line">Jump found. (Code = 62) Position 1 = -2</span><br><span class="line">Branch analysis from position: 15</span><br><span class="line">filename:       /Users/jianyong/demo/a.php</span><br><span class="line">function name:  (null)</span><br><span class="line">number of ops:  17</span><br><span class="line">compiled vars:  !0 = $arr, !1 = $v, !2 = $k</span><br><span class="line">line     #* E I O op                           fetch          ext  return  operands</span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">   2     0  E &gt;   ASSIGN                                                   !0, &lt;array&gt;</span><br><span class="line">   4     1      &gt; FE_RESET_R                                       $4      !0, -&gt;15</span><br><span class="line">         2    &gt; &gt; FE_FETCH_R                                       ~5      $4, !1, -&gt;15</span><br><span class="line">         3    &gt;   ASSIGN                                                   !2, ~5</span><br><span class="line">   5     4        INIT_FCALL                                               &apos;key&apos;</span><br><span class="line">         5        SEND_VAR                                                 !0</span><br><span class="line">         6        DO_ICALL                                         $7</span><br><span class="line">         7        ECHO                                                     $7</span><br><span class="line">         8        ECHO                                                     &apos;%3D%3E&apos;</span><br><span class="line">         9        INIT_FCALL                                               &apos;current&apos;</span><br><span class="line">        10        SEND_VAR                                                 !0</span><br><span class="line">        11        DO_ICALL                                         $8</span><br><span class="line">        12        ECHO                                                     $8</span><br><span class="line">        13        ECHO                                                     &apos;%0A&apos;</span><br><span class="line">        14      &gt; JMP                                                      -&gt;2</span><br><span class="line">        15    &gt;   FE_FREE                                                  $4</span><br><span class="line">   7    16      &gt; RETURN                                                   1</span><br><span class="line"></span><br><span class="line">branch: #  0; line:     2-    4; sop:     0; eop:     1; out1:   2; out2:  15</span><br><span class="line">branch: #  2; line:     4-    4; sop:     2; eop:     2; out1:   3; out2:  15</span><br><span class="line">branch: #  3; line:     4-    5; sop:     3; eop:    14; out1:   2</span><br><span class="line">branch: # 15; line:     5-    7; sop:    15; eop:    16; out1:  -2</span><br><span class="line">path #1: 0, 2, 3, 2, 15,</span><br><span class="line">path #2: 0, 2, 15,</span><br><span class="line">path #3: 0, 15,</span><br><span class="line">0=&gt;a</span><br><span class="line">0=&gt;a</span><br><span class="line">0=&gt;a</span><br></pre></td></tr></table></figure></p>
<p><strong>// 待补充</strong></p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul>
<li><a href="https://wiki.php.net/rfc/php7_foreach" target="_blank" rel="noopener">https://wiki.php.net/rfc/php7_foreach</a></li>
<li><a href="http://git.php.net/?p=php-src.git;a=commitdiff;h=97fe15db4356f8fa1b3b8eb9bb1baa8141376077" target="_blank" rel="noopener">97fe15db4356f8fa1b3b8eb9bb1baa8141376077</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jianyong.github.io/2018/02/11/PHP扩展安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jianyong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="行易难">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/11/PHP扩展安装/" itemprop="url">PHP扩展安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-11T00:08:23+08:00">
                2018-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###源码中扩展文件安装(如pcntl扩展)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget http://cn2.php.net/distributions/php-5.5.7.tar.gz</span><br><span class="line">tar zxvf php-5.5.7.tar.gz</span><br><span class="line">cd php-5.5.7</span><br><span class="line"></span><br><span class="line">cd ext/pcntl</span><br><span class="line">/usr/bin/phpize</span><br><span class="line">./configure --with-php-config=bin/php-config   #（ps:请正确的指定php-config的目录）</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p>
<p>###php_oci 安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 安装oci必须先安装oracle-instantclient, 去官网下载相应版本的客户端的rpm包, 直接安装即可</span><br><span class="line">rpm -Uvh oracle-instantclient11.2-basic-11.2.0.3.0-1.x86_64.rpm </span><br><span class="line">rpm -Uvh oracle-instantclient11.2-devel-11.2.0.3.0-1.x86_64.rpm </span><br><span class="line"></span><br><span class="line"># 第一个 RPM 将 Oracle 库放在 /usr/lib/oracle/11.2/client64/lib 中</span><br><span class="line"># 第二个 RPM 在/usr/include/oracle/11.2/client64 中创建头。</span><br><span class="line"></span><br><span class="line">pecl install oci8</span><br></pre></td></tr></table></figure></p>
<p>###源码安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf memcached.tar.gz</span><br><span class="line">cd memcached</span><br><span class="line">phpize</span><br><span class="line">./configure --with-php-config=bin/php-config </span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p>
<p>###修改PHP配置文件, 加入相应扩展<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">extension=memcache.so</span><br><span class="line">extension=pcntl.so</span><br><span class="line">extension=oci8.so</span><br></pre></td></tr></table></figure></p>
<p>###常见问题</p>
<h6 id="TODO-通过源码安装pdo-oci时会出现一些问题"><a href="#TODO-通过源码安装pdo-oci时会出现一些问题" class="headerlink" title="TODO 通过源码安装pdo_oci时会出现一些问题"></a>TODO 通过源码安装pdo_oci时会出现一些问题</h6><ul>
<li>configure: error: Unsupported Oracle version! 12.1</li>
<li>将pdo_oci的版本由 PDO_OCI-1.0 换成 PDO_OCI-1.0RC2</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jianyong.github.io/2018/02/11/PHPExcel长数字处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jianyong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="行易难">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/11/PHPExcel长数字处理/" itemprop="url">PHPExcel长数字处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-11T00:05:31+08:00">
                2018-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在excel中如果在一个默认的格中输入或复制超长数字字符串，它会显示为科学计算法，例如身份证号码，解决方法是把表格设置文本格式或在输入前加一个单引号。<br>使用PHPExcel来生成excel，也会遇到同样的问题，解决方法有三种：</p>
<h3 id="1、设置单元格为文本"><a href="#1、设置单元格为文本" class="headerlink" title="1、设置单元格为文本"></a>1、设置单元格为文本</h3></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$objPHPExcel = new PHPExcel();</span><br><span class="line">$objPHPExcel-&gt;setActiveSheetIndex(0);</span><br><span class="line">$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(&apos;Simple&apos;);</span><br><span class="line"></span><br><span class="line">//设置A3单元格为文本</span><br><span class="line">$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(&apos;A3&apos;)-&gt;getNumberFormat()</span><br><span class="line">        -&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);</span><br><span class="line"></span><br><span class="line">//也可以设置整行或整列的style</span><br><span class="line">/*</span><br><span class="line">//E 列为文本</span><br><span class="line">$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(&apos;E&apos;)-&gt;getNumberFormat()</span><br><span class="line">	-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);</span><br><span class="line"></span><br><span class="line">//第三行为文本</span><br><span class="line">$objPHPExcel-&gt;getActiveSheet()-&gt;getStyle(&apos;3&apos;)-&gt;getNumberFormat()</span><br><span class="line">	-&gt;setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_TEXT);</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<blockquote>
<p>更多的格式可以在PHPExcel/Style/NumberFormat.php中找到。注意：上述的设置对长数字字符串还是以文本方式来显示科学计数法的结果，原因可能php在处理大数字时采用的科学计数法。</p>
</blockquote>
<h3 id="2、在设置值的时候显示的指定数据类型"><a href="#2、在设置值的时候显示的指定数据类型" class="headerlink" title="2、在设置值的时候显示的指定数据类型"></a>2、在设置值的时候显示的指定数据类型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$objPHPExcel = new PHPExcel();</span><br><span class="line">$objPHPExcel-&gt;setActiveSheetIndex(0);</span><br><span class="line">$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(&apos;Simple&apos;);</span><br><span class="line"> </span><br><span class="line">$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValueExplicit(&apos;D1&apos;, 123456789033, PHPExcel_Cell_DataType::TYPE_STRING);</span><br></pre></td></tr></table></figure>
<h3 id="3、在数字字符串前加一个空格使之成为字符串"><a href="#3、在数字字符串前加一个空格使之成为字符串" class="headerlink" title="3、在数字字符串前加一个空格使之成为字符串"></a>3、在数字字符串前加一个空格使之成为字符串</h3>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$objPHPExcel = new PHPExcel();</span><br><span class="line">$objPHPExcel-&gt;setActiveSheetIndex(0);</span><br><span class="line">$objPHPExcel-&gt;getActiveSheet()-&gt;setTitle(&apos;Simple&apos;);</span><br><span class="line"> </span><br><span class="line">$objPHPExcel-&gt;getActiveSheet()-&gt;setCellValue(&apos;D1&apos;, &apos; &apos; . 123456789033);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>推荐使用第二、三种，第一种没有根本解决问题。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jianyong.github.io/2018/02/11/sso/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jianyong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="行易难">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/11/sso/" itemprop="url">sso</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-11T00:03:44+08:00">
                2018-02-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SSO调研和部署相关"><a href="#SSO调研和部署相关" class="headerlink" title="SSO调研和部署相关"></a>SSO调研和部署相关</h1><blockquote>
<p>登录是服务化必不可少的一步, 行业大多通过单点登录(SSO)来解决此问题, 当然不同公司实现的方式也不相同.</p>
</blockquote>
<h3 id="现有登录流程"><a href="#现有登录流程" class="headerlink" title="现有登录流程"></a>现有登录流程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: 点击菜单</span><br><span class="line">end=&gt;end: 结束</span><br><span class="line">loginCheck=&gt;condition: 是否登录</span><br><span class="line">success=&gt;operation: 访问成功</span><br><span class="line">failed=&gt;operation: 访问失败</span><br><span class="line">login=&gt;condition: 登录</span><br><span class="line"></span><br><span class="line">st-&gt;loginCheck</span><br><span class="line">loginCheck(yes)-&gt;success</span><br><span class="line">loginCheck(no)-&gt;login</span><br><span class="line">login(yes)-&gt;success</span><br><span class="line">login(no)-&gt;failed</span><br><span class="line">success-&gt;end</span><br><span class="line">failed-&gt;end</span><br></pre></td></tr></table></figure>
<h3 id="服务化后的登录流程"><a href="#服务化后的登录流程" class="headerlink" title="服务化后的登录流程"></a>服务化后的登录流程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">start=&gt;start: 点击菜单</span><br><span class="line">end=&gt;end: 结束</span><br><span class="line">loginCheck=&gt;condition: 是否登录</span><br><span class="line">success=&gt;operation: 访问成功</span><br><span class="line">ssoAuth=&gt;condition: SSO验证</span><br><span class="line">ssoLogin=&gt;condition: SSO登录</span><br><span class="line">failed=&gt;operation: 访问失败</span><br><span class="line">ssoNotify=&gt;operation: SSO通知</span><br><span class="line"></span><br><span class="line">start-&gt;loginCheck</span><br><span class="line">loginCheck(yes)-&gt;success</span><br><span class="line">loginCheck(no)-&gt;ssoAuth</span><br><span class="line">ssoAuth(yes)-&gt;success</span><br><span class="line">ssoAuth(no)-&gt;ssoLogin</span><br><span class="line">ssoLogin(yes)-&gt;ssoNotify-&gt;success</span><br><span class="line">ssoLogin(no)-&gt;failed</span><br><span class="line">failed-&gt;end</span><br><span class="line">success-&gt;end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">APP-&gt;SSO: 验证是否登录</span><br><span class="line">Note right of SSO: 验证是否登录</span><br><span class="line">SSO-&gt;APP: 验证失败</span><br><span class="line"></span><br><span class="line">APP-&gt;SSO: 登录</span><br><span class="line">Note right of SSO: 登录验证</span><br><span class="line">SSO-&gt;APP: 通知应用登录成功</span><br><span class="line"></span><br><span class="line">APP-&gt;SSO: 验证是否登录</span><br><span class="line">Note right of SSO: 验证是否登录</span><br><span class="line">SSO-&gt;APP: 验证成功</span><br><span class="line">Note left of APP: 重置APP的 session id</span><br></pre></td></tr></table></figure>
<h3 id="完整的SSO登录时序图和流程图"><a href="#完整的SSO登录时序图和流程图" class="headerlink" title="完整的SSO登录时序图和流程图"></a>完整的SSO登录时序图和流程图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">浏览器-&gt;客户端: 1. 用户请求</span><br><span class="line">客户端-&gt;客户端: 2. 验证是否已经登录</span><br><span class="line">客户端-&gt;SSO: 3. 没有登录,重定向至SSO服务器</span><br><span class="line">SSO-&gt;SSO: 4. 登录流程</span><br><span class="line">SSO-&gt;客户端: 5. 携带凭据重定向回客户端</span><br><span class="line">客户端-&gt;SSO: 6.验证凭据是否有效</span><br><span class="line">SSO-&gt;客户端: 7. 有效则正常显示页面</span><br><span class="line">客户端-&gt;浏览器: 8. 完成</span><br></pre></td></tr></table></figure>
<h6 id="对应流程图"><a href="#对应流程图" class="headerlink" title="对应流程图"></a>对应流程图</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">start=&gt;start: 访问页面</span><br><span class="line">end=&gt;end: 结束</span><br><span class="line">getToken=&gt;operation: 截取token</span><br><span class="line">checkToken=&gt;condition: token是否有效</span><br><span class="line">handle=&gt;operation: 后续动作</span><br><span class="line">ssoLogin=&gt;operation: 登录</span><br><span class="line">syncToken=&gt;operation: 登录成功同步token至客户端</span><br><span class="line">saveToken=&gt;operation: 种植token</span><br><span class="line"></span><br><span class="line">start-&gt;getToken-&gt;checkToken</span><br><span class="line">checkToken(yes)-&gt;handle-&gt;end</span><br><span class="line">checkToken(no)-&gt;ssoLogin-&gt;syncToken-&gt;saveToken-&gt;end</span><br></pre></td></tr></table></figure>
<h3 id="一个相对完整的APP-SSO登录时序图"><a href="#一个相对完整的APP-SSO登录时序图" class="headerlink" title="一个相对完整的APP SSO登录时序图"></a>一个相对完整的APP SSO登录时序图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">App-&gt;Web: 请求需要的登录页</span><br><span class="line">Web-&gt;App: 返回302跳转</span><br><span class="line">App-&gt;SSO: 带token跳转到登录页</span><br><span class="line">SSO-&gt;AppServer: token</span><br><span class="line">AppServer-&gt;SSO: 返回用户ID</span><br><span class="line">SSO-&gt;SSO: 生成用户登录信息</span><br><span class="line">SSO-&gt;App: 带token302跳转</span><br><span class="line">App-&gt;Web: 带token跳转到回调页</span><br><span class="line">Web-&gt;SSO: 凭token请求Auth</span><br><span class="line">SSO-&gt;Web: 返回用户ID等信息</span><br><span class="line">Web-&gt;Web: 生成用户登录信息</span><br><span class="line">Web-&gt;App: 返回请求的页面</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jianyong.github.io/2018/02/10/使用composer开发PHP扩展库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jianyong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="行易难">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/10/使用composer开发PHP扩展库/" itemprop="url">使用composer开发PHP扩展库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-10T23:33:43+08:00">
                2018-02-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="已完成的扩展库"><a href="#已完成的扩展库" class="headerlink" title="已完成的扩展库"></a>已完成的扩展库</h3><table>
<thead>
<tr>
<th>序号</th>
<th>库名</th>
<th style="text-align:center">地址</th>
<th style="text-align:right">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>phprush/demo</td>
<td style="text-align:center"><a href="https://github.com/phprush/demo.git" target="_blank" rel="noopener">https://github.com/phprush/demo.git</a></td>
<td style="text-align:right">演示库</td>
</tr>
<tr>
<td>2</td>
<td>phprush/websocket</td>
<td style="text-align:center"><a href="https://github.com/phprush/websocket.git" target="_blank" rel="noopener">https://github.com/phprush/websocket.git</a></td>
<td style="text-align:right">php websocket 客户端库</td>
</tr>
<tr>
<td>3</td>
<td>phprush/wechat-applet</td>
<td style="text-align:center"><a href="https://github.com/phprush/wechat-applet.git" target="_blank" rel="noopener">https://github.com/phprush/wechat-applet.git</a></td>
<td style="text-align:right">微信小程序SDK封装(laravel使用)</td>
</tr>
<tr>
<td>4</td>
<td>phprush/simple-encrypt</td>
<td style="text-align:center"><a href="https://github.com/phprush/simple-encrypt.git" target="_blank" rel="noopener">https://github.com/phprush/simple-encrypt.git</a></td>
<td style="text-align:right">一个简单的加密库</td>
</tr>
<tr>
<td>5</td>
<td>phprush/requests</td>
<td style="text-align:center"><a href="https://github.com/phprush/requests.git" target="_blank" rel="noopener">https://github.com/phprush/requests.git</a></td>
<td style="text-align:right">一个简单的http请求库</td>
</tr>
</tbody>
</table>
<h3 id="库的开发方式"><a href="#库的开发方式" class="headerlink" title="库的开发方式"></a>库的开发方式</h3><ul>
<li>composer init</li>
<li>composer.json 中使用psr-4规范配置autoload</li>
<li>src中开发代码</li>
<li>github/packagist中发布代码</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">jianyong</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jianyong</span>

  
</div>


<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
  </span>
  </div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
